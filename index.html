<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backtesting Engine</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Financial Chart Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <!--Data Science-->
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js + Plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Import Apache ECharts from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@6.0/dist/echarts.min.js"></script>
</head>
<body class="bg-gray-900 text-gray-100 font-sans flex h-screen overflow-hidden">

    <!-- Header -->
    <header class="main-header">
    <div class="header-center">
        <div class="balance">Balance: $100,000</div>
        <div class="pl">Total P/L: +$0.00</div>
    </div>
    </header>

    <!-- Sidebar Icons -->
    <aside class="icons-sidebar">
    <!-- Logo -->
    <div class="sidebar-logo">
        <img src="./assets/logo.png" alt="Trading Vibes Logo"
        onerror="this.onerror=null; this.src='https://placehold.co/32x32/007ACC/FFFFFF?text=TV'">
    </div>

    <div class="icon-group top-icons">
        <!-- Order -->
        <div id="iconOrder" class="sidebar-icon" title="Order">
        <i data-lucide="shopping-cart" class="w-6 h-6"></i>
        </div>

        <!-- Account Performance -->
        <div id="iconPerformance" class="sidebar-icon" title="Account Performance">
        <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
        </div>

        <!-- Edit Account -->
        <div id="iconEditAccount" class="sidebar-icon" title="Edit Account">
        <i data-lucide="user-cog" class="w-6 h-6"></i>
        </div>

        <!-- Notes -->
        <div id="iconNotes" class="sidebar-icon" title="Notes">
        <i data-lucide="notebook" class="w-6 h-6"></i>
        </div>
    </div>

    <div class="icon-group bottom-icons">
        <!-- Settings -->
        <div id="iconSettings" class="sidebar-icon" title="Settings">
        <i data-lucide="settings" class="w-6 h-6"></i>
        </div>

        <!-- Documentation -->
        <div id="iconDocs" class="sidebar-icon" title="Documentation">
        <i data-lucide="book-open-text" class="w-6 h-6"></i>
        </div>

        <!-- Profile -->
        <div id="iconProfile" class="sidebar-icon" title="Profile">
        <i data-lucide="circle-user-round" class="w-6 h-6"></i>
        </div>
    </div>
    </aside>

   <!-- Main Content Area -->
   <main id="mainContent" class="main-layout">  

    <!-- Main Chart Container -->
    <div id="mainChartContainer" class="main-chart-container">

        <!--Date & Time-->
        <div id="DateTime" class="dateTime">
            <!-- Date Input -->
            <input 
                type="date" 
                id="chartDate" 
                class="bg-transparent text-white border border-gray-600 rounded px-2 py-1 text-sm">

            <!-- Time Input -->
            <input 
                type="time" 
                id="chartTime" 
                step="60"  
                class="bg-transparent text-white border border-gray-600 rounded px-2 py-1 text-sm"/>

            <!-- Go Button -->
            <button 
                id="goToDateTime" 
                class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded text-sm">
                Go
            </button>
        </div>  

        <!-- Toolbar -->
        <div id="chartToolbar" class="chart-tool-bar">

            <!-- Cursor / Crosshair -->
            <button id="tool-cursor" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-mouse-pointer text-white"></i>
            </button>
            <button id="tool-crosshair" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-crosshairs text-white"></i>
            </button>
            <button id="tool-screenshot" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-camera text-white"></i>
            </button>

        </div>

        <div id="chartToolbar2" class="chart-tool-bar2">

            <!--Drawings Dropdown -->
                <button id="dropdown-drawings-btn" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-pencil-ruler text-white"></i>
                </button>
                <div id="dropdown-drawings" class="absolute hidden mt-2 w-40 bg-gray-800 rounded shadow-lg text-white">
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tool-trendline">Trendline</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tool-hline">Horizontal Line</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tool-vline">Vertical Line</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tool-ray">Ray</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tool-arrow">Arrow</button>
                </div>
            
                <!-- Timeframes Dropdown -->
            <div class="relative">
                <button id="dropdown-timeframes-btn" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-clock text-white"></i>
                </button>
                <div id="dropdown-timeframes" class="absolute hidden mt-2 w-32 bg-gray-800 rounded shadow-lg text-white">
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tf-1m">1m</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tf-5m">5m</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tf-15m">15m</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tf-1h">1h</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="tf-1d">1D</button>
                </div>
            </div>

            <!-- Chart Types Dropdown -->
            <div class="relative">
                <button id="dropdown-charttypes-btn" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-chart-area text-white"></i>
                </button>
                <div id="dropdown-charttypes" class="absolute hidden mt-2 w-40 bg-gray-800 rounded shadow-lg text-white">
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="chart-candles">Candlesticks</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="chart-bars">Bars</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="chart-line">Line</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="chart-heikin">Heikin Ashi</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="chart-hollow">Hollow Candles</button>
                </div>
            </div>

            <!-- Indicators Dropdown -->
            <div class="relative">
                <button id="dropdown-indicators-btn" class="p-2 rounded hover:bg-gray-700 bg-transparent">
                <i class="fas fa-chart-line text-white"></i>
                </button>
                <div id="dropdown-indicators" class="absolute hidden mt-2 w-48 bg-gray-800 rounded shadow-lg text-white">
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="indicator-rsi">RSI</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="indicator-macd">MACD</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="indicator-ema">EMA</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="indicator-sma">SMA</button>
                <button class="block w-full text-left px-4 py-2 hover:bg-gray-700" id="indicator-bbands">Bollinger Bands</button>
                </div>
            </div>

        </div>

        <!--Market Replay-->
        <div id="chartToolbar3" class="chart-tool-bar3">
            
            <!-- Market Replay -->
        <div id="marketReplayControls" class="flex items-center gap-2 bg-black/40 p-2 rounded-lg">
        <!-- Enable Replay -->
        <label class="flex items-center gap-1 text-white text-sm">
            <input type="checkbox" id="marketReplayEnable" class="accent-blue-600">
            Market Replay
        </label>

        <!-- Rewind -->
        <button id="replayRewind" class="p-2 rounded hover:bg-gray-700 bg-transparent">
            <i class="fas fa-backward text-white"></i>
        </button>

        <!-- Play / Pause -->
        <button id="replayPlayPause" class="p-2 rounded hover:bg-gray-700 bg-transparent">
            <i class="fas fa-play text-white" id="replayPlayIcon"></i>
        </button>

        <!-- Forward -->
        <button id="replayForward" class="p-2 rounded hover:bg-gray-700 bg-transparent">
            <i class="fas fa-forward text-white"></i>
        </button>

        <!-- Speed Controls -->
        <select id="replaySpeed" class="bg-gray-800 text-white rounded px-2 py-1 text-sm">
            <option value="2000">0.5x</option>
            <option value="1000" selected>1x</option>
            <option value="500">2x</option>
            <option value="200">5x</option>
        </select>

         <!-- Zoom Controls -->
        <button id="zoomOut" class="p-2 rounded hover:bg-gray-700 bg-transparent text-white">
            <i class="fas fa-search-minus"></i> 
        </button>
        <button id="zoomIn" class="p-2 rounded hover:bg-gray-700 bg-transparent text-white">
            <i class="fas fa-search-plus"></i> 
        </button>
        </div>
     


        </div>

        <div id="chart-10" class="chart-full">
        </div>
    </div>
   </main>
   
    </div>
    </div>

    <!-- Modal for Backtest Config -->
    <!-- backtest-config-modal.html -->
    <div id="backtestConfigModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="modal-content bg-gray-800 rounded-lg p-6 w-80 max-h-[80vh] overflow-y-auto scrollbar-hide text-white border border-white/30">
    <h2 class="text-xl font-bold mb-4">Backtest Configuration</h2>

    <form id="backtestConfigForm" class="space-y-6">

      <!-- Trade Settings Section -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold mb-2 border-b border-gray-600 pb-1">Trade Settings</h3>
        <div>
          <label for="tradeType" class="block mb-1">Trade Type</label>
          <select id="tradeType" name="tradeType" class="w-full rounded p-2 bg-gray-700 text-white">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </div>
        <div>
          <label for="amountPerTrade" class="block mb-1">Amount per Trade</label>
          <input type="number" id="amountPerTrade" name="amountPerTrade" class="w-full rounded p-2 bg-gray-700 text-white" min="0" step="0.01" required />
        </div>
        <div>
          <label for="accountBalance" class="block mb-1">Account Balance</label>
          <input type="number" id="accountBalance" name="accountBalance" class="w-full rounded p-2 bg-gray-700 text-white" min="0" step="0.01" required />
        </div>
      </div>

      <!-- Risk Management Section -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold mb-2 border-b border-gray-600 pb-1">Risk Management</h3>
        <div>
          <label for="slippage" class="block mb-1">Slippage (points)</label>
          <input type="number" id="slippage" name="slippage" class="w-full rounded p-2 bg-gray-700 text-white" min="0" step="0.01" required />
        </div>
        <div>
          <label for="stopLoss" class="block mb-1">Stop-Loss (pips)</label>
          <input type="number" id="stopLoss" name="stopLoss" class="w-full rounded p-2 bg-gray-700 text-white" min="0" step="0.1" required />
        </div>
        <div>
          <label for="takeProfit" class="block mb-1">Take-Profit (pips)</label>
          <input type="number" id="takeProfit" name="takeProfit" class="w-full rounded p-2 bg-gray-700 text-white" min="0" step="0.1" required />
        </div>
      </div>

      <!-- Backtest Period Section -->
      <div class="space-y-4">
        <h3 class="text-lg font-semibold mb-2 border-b border-gray-600 pb-1">Backtest Period</h3>
        <div>
          <label for="startDate" class="block mb-1">Start Date</label>
          <input type="date" id="startDate" name="startDate" class="w-full rounded p-2 bg-gray-700 text-white" required />
        </div>
        <div>
          <label for="endDate" class="block mb-1">End Date</label>
          <input type="date" id="endDate" name="endDate" class="w-full rounded p-2 bg-gray-700 text-white" required />
        </div>
      </div>

      <!-- Buttons -->
    <div class="flex justify-center space-x-4 pt-4">
        <button type="button" id="cancelBacktestConfig" class="bg-gray-600 px-4 py-2 rounded hover:bg-gray-700">Cancel</button>
        <button type="submit" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 font-bold">Run Backtest</button>
    </div>


    </form>
  </div>
    </div>

    <!-- Custom JavaScript -->
    <script src="script.js"></script>
    <script src="js/compilerLogic.js"></script>
    <script src="js/backtestConfig.js"></script>
    <script src="js/conditionsBlock.js"></script>
    <script src="js/checkObject.js"></script>
    <script src="js/header.js"></script>
    <script src="js/candleStickChart.js"></script> 
    <script src="js/runBacktestInIframe.js"></script>
    <script src="js/conditionsReader.js"></script>
    <script src="js/leftPanelSwitcher.js"></script>
    <script src="js/chartResize.js"></script>
    <script src="js/chartTools.js"></script>
    <script src="js/datetime-navigator.js"></script>
    <script src="js/market-replay.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();
    </script>

</body>
</html>